---
title: HTML渲染之重绘重排
nav:
  title: 基础沉淀
  path: /article
group:
  path: /browser
  title: 浏览器
  order: 2
order: 3
---

# HTML 渲染之重绘重排

## 什么是重绘重排

### 重排（回流）

当 DOM 的变化影响了元素的几何信息(元素的的位置和尺寸大小)，浏览器需要重新计算元素的几何属性，将其安放在界面中的正确位置，这个过程叫做`重排(回流)`。这个修改会让浏览器从布局开始更新整个渲染流水线，这个开销是最大的。

#### 触发条件

回流这一阶段主要是计算节点的位置和几何信息，当页面布局和几何信息发生变化的时候，就需要回流。

- 一个 DOM 元素的几何属性变化，常见的几何属性有 width、height、padding、margin、left、top、border 等等。
- 使 DOM 节点发生增减或者移动。
- 读写 offset 家族、scroll 家族和 client 家族属性的时候，浏览器为了获取这些值，需要进行回流操作。
- 调用 window.getComputedStyle 方法。

#### 重排影响的范围

由于浏览器渲染界面是基于流式布局模型的，所以触发重排时会对周围 DOM 重新排列，影响的范围有两种：

- 全局范围：从根节点 html 开始对整个渲染树进行重新布局。
- 局部范围：对渲染树的某部分或某一个渲染对象进行重新布局

### 重绘

当一个元素的外观发生改变，但没有改变布局,重新把元素外观绘制出来的过程，叫做`重绘`。在重绘阶段，系统会遍历渲染树，并调用渲染对象的 `paint` 方法，将渲染对象的内容显示在屏幕上。相较于重排操作，重绘省去了布局阶段，所以执行效率会比重排操作要高一些。

#### 触发条件

重绘是一个元素外观的改变所触发的浏览器行为，例如改变 `visibility`、`outline`、`background-color` 等属性，这些属性只是影响元素的外观，风格，并且没有影响几何属性的时候，会导致`重绘repaint`。

### 总结

`重排`必定会发生`重绘`，`重绘`不一定会引发`重排`。

## 像素管道

浏览器运行的单个帧的渲染流水线，称为像素管道。一个经典的图：

<img src="./ab"/>
